<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="מתקרבים לזוגות">
    <meta name="apple-mobile-web-app-title" content="מתקרבים לזוגות">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no, user-scalable=no">
    <meta name="description" content="משחק שיחות עומק לחיזוק הקשר וההתחברות הרגשית. שאלות, רגשות, ופרסים ליצירת חוויה בלתי נשכחת.">
    <meta name="keywords" content="משחק, שיחות עומק, קלפי שאלות, תקשורת, פרסים">

    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>💞</text></svg>">

    <title>מתקרבים - גרסה זוגית 3.6</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700&display=swap');
        
        :root {
            --primary-color: #667eea; --secondary-color: #764ba2; --accent-color: #ed8936;
            --success-color: #48bb78; --danger-color: #fc8181; --text-dark: #2d3748;
            --text-light: #4a5568; --background-light: rgba(255, 255, 255, 0.98); --border-light: #e2e8f0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        html, body { height: 100%; overflow: hidden; position: fixed; width: 100%; }

        body {
            font-family: 'Heebo', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #16213e 75%, #1a1a2e 100%);
            background-attachment: fixed;
            display: flex; justify-content: center; align-items: center;
        }

        /* --- סגנון מסך הטעינה --- */
        .loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460, #533483, #764ba2); background-size: 400% 400%; animation: gradientFlow 10s ease-in-out infinite; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10000; }
        @keyframes gradientFlow { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
        .loading-logo { font-size: 6em; margin-bottom: 20px; animation: logoMagic 4s ease-in-out infinite; filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.7)); }
        @keyframes logoMagic { 0%, 100% { transform: translateY(-10px) scale(1); } 50% { transform: translateY(10px) scale(1.1); } }
        .loading-title { color: white; font-size: 3em; font-weight: 700; margin-bottom: 10px; }
        .loading-subtitle { color: rgba(255, 255, 255, 0.9); font-size: 1.3em; margin-bottom: 40px; }
        .loading-progress-container { display: flex; align-items: center; gap: 20px; justify-content: center; }
        .loading-progress { width: min(400px, 80vw); height: 12px; background: rgba(255, 255, 255, 0.15); border-radius: 15px; overflow: hidden; }
        .loading-bar { height: 100%; background: linear-gradient(90deg, #667eea, #764ba2, #f093fb); border-radius: 15px; width: 0%; transition: width 0.4s ease-out; }
        .loading-percentage { color: white; font-size: 1.6em; font-weight: 700; min-width: 60px; }
        .loading-screen.fade-out { animation: loadingDisappear 1s forwards; }
        @keyframes loadingDisappear { to { opacity: 0; transform: scale(1.1); filter: blur(5px); } }

        /* --- סגנון המשחק הכללי --- */
        .container { background: var(--background-light); backdrop-filter: blur(20px); border-radius: 25px; padding: 40px 30px; box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3); max-width: 900px; width: 95%; text-align: center; border: 1px solid rgba(255, 255, 255, 0.2); opacity: 0; max-height: 90vh; overflow-y: auto; }
        @keyframes containerFadeIn { to { opacity: 1; } }
        h1 { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 20px; font-size: 2.4em; }
        h2 { color: var(--text-dark); font-size: 1.8em; margin-bottom: 15px; }
        .screen { display: none; }
        .screen.active { display: block; animation: screenFadeIn 0.5s ease-out; }
        @keyframes screenFadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .input-group { margin-bottom: 20px; text-align: right; }
        .input-group label { display: block; margin-bottom: 8px; font-size: 1.2em; font-weight: 500; }
        .input-group input { width: 100%; padding: 15px; border: 2px solid var(--border-light); border-radius: 15px; font-size: 1.2em; text-align: right; }
        .main-btn { background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: white; border: none; padding: 18px 40px; font-size: 1.4em; font-weight: 600; border-radius: 60px; cursor: pointer; transition: all 0.4s ease; box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3); margin-top: 25px; }
        .secondary-btn { background: linear-gradient(135deg, var(--accent-color), #dd6b20); color: white; border: none; padding: 12px 25px; font-size: 1.1em; border-radius: 25px; cursor: pointer; }
        .current-player-display { padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 2px solid; }
        .current-player-display.husband { background: linear-gradient(135deg, #d3e4ff, #a7c7fa); border-color: #6a9cf2; }
        .current-player-display.wife { background: linear-gradient(135deg, #fed7d7, #feb2b2); border-color: var(--danger-color); }
        .result-container { margin-top: 30px; padding: 30px; background: #f7fafc; border-radius: 20px; min-height: 120px; display: flex; align-items: center; justify-content: center; }
        .question-text { font-size: 1.5em; line-height: 1.6; color: var(--text-dark); text-align: right; }
        .emotion-highlight { color: var(--primary-color); font-weight: 700; background: linear-gradient(120deg, #a8edea, #fed6e3); padding: 4px 12px; border-radius: 8px; }
        #change-buttons, #difficulty-container { display: none; margin-top: 20px; gap: 15px; justify-content: center; flex-wrap: wrap;}
        .scoring-container { margin: 30px 0; }
        .scoring-container label { font-size: 1.1em; font-weight: 500; margin-bottom: 15px; display: block; }
        .scoring-input-wrapper { display: flex; align-items: center; gap: 20px; }
        .scoring-input-wrapper input[type="range"] { flex-grow: 1; cursor: pointer; }
        .score-display { font-weight: 700; color: var(--primary-color); font-size: 1.8em; min-width: 50px; text-align: center; background: #edf2f7; padding: 5px 10px; border-radius: 8px; border: 2px solid var(--border-light); }
        .instructions-text { text-align: right; line-height: 1.8; font-size: 1.1em; margin-bottom: 25px; color: var(--text-dark); }
    </style>
</head>
<body>
    <div class="loading-screen" id="loading-screen">
        <div class="loading-logo">💞</div>
        <div class="loading-title">מתקרבים</div>
        <div class="loading-subtitle">חוויה זוגית מיוחדת נטענת...</div>
        <div class="loading-progress-container">
            <div class="loading-progress">
                <div class="loading-bar" id="loading-bar"></div>
            </div>
            <div class="loading-percentage" id="loading-percentage">0%</div>
        </div>
    </div>

    <div class="container" id="main-container" style="opacity:0;">
        <!-- שלב 1: מסך ההסברים -->
        <div id="instructions-screen" class="screen active">
            <h1>ברוכים הבאים ל'מתקרבים' - משחק זוגי מקרב</h1>
            <h2 style="font-size: 1.5em;">איך המשחק עובד?</h2>
            <p class="instructions-text">
               מטרת המשחק היא לעורר שיח מעמיק ומקרב. 
             <br><br>
             בכל תור, המשחק יציג שאלה על רגש מסוים. השאלה נועדה להיות נקודת פתיחה למחשבה ושיתוף.
            <br><br>
            כל אחד בתורו מתבקש לענות על השאלה בכנות ובפתיחות. קחו את הזמן, אין כאן תשובות נכונות או לא נכונות. המטרה היא לדבר מהלב, לשתף בכנות במחשבות, בזיכרונות ובתחושות שלכם.
            </p>
            <h2 style="font-size: 1.8em;">תיהנו!</h2>
            <button class="main-btn" onclick="proceedToSetup()">בואו נתחיל!</button>
        </div>

        <!-- שלב 2: הזנת שמות -->
        <div id="setup-screen" class="screen">
            <h1>הזוג המאושר</h1>
            <div class="input-group">
                <label for="husband-name">הבעל היקר:</label>
                <input type="text" id="husband-name" placeholder="הכנס את שמך">
            </div>
            <div class="input-group">
                <label for="wife-name">האישה היקרה:</label>
                <input type="text" id="wife-name" placeholder="הכניסי את שמך">
            </div>
            <button class="main-btn" onclick="proceedToHusbandPrize()">לשלב הבא</button>
        </div>

        <!-- שלב 3.1: פרס לבעל -->
        <div id="husband-prize-screen" class="screen">
            <h1 id="husband-prize-title">🎁 הפרס שלך</h1>
            <h3>רשום בסוד מהי מתנה שהיית רוצה לקבל. אשתך לא תראה...</h3>
            <div class="input-group">
                <label for="husband-prize">המתנה שאני רוצה:</label>
                <input type="text" id="husband-prize" placeholder="לדוגמה: מסאז' של 10 דקות">
            </div>
            <button class="main-btn" onclick="proceedToWifePrize()">סיימת? עכשיו תורה לענות</button>
        </div>

        <!-- שלב 3.2: פרס לאישה -->
        <div id="wife-prize-screen" class="screen">
            <h1 id="wife-prize-title">🎁 הפרס שלך</h1>
            <h3>עכשיו תורך, רשמי בסוד איזו מתנה תרצי לקבל.</h3>
            <div class="input-group">
                <label for="wife-prize">המתנה שאני רוצה:</label>
                <input type="text" id="wife-prize" placeholder="לדוגמה: פינוק מתוק שאני אוהבת">
            </div>
            <button class="main-btn" onclick="startGame()">שומרת ומתחילים לשחק! 🎯</button>
        </div>

        <!-- שלב 4: המשחק -->
        <div id="game-screen" class="screen">
            <div class="current-player-display" id="current-player-display"><h2 id="turn-indicator"></h2><p id="turn-prompt"></p></div>
            <div class="result-container"><div id="result" class="placeholder-text">לחצו על הכפתור...</div></div>
            <div style="margin-top: 25px;"><button class="main-btn" id="draw-btn" onclick="drawPair()"></button></div>
            <div id="difficulty-container"><button class="secondary-btn" onclick="showChangeOptions()">🤔 אמממ... קשה לי לענות על זה... רוצה להחליף שאלה</button></div>
            <div id="change-buttons"><button class="secondary-btn" onclick="changeQuestion()">🔄 שאלה אחרת על הרגש הזה</button><button class="secondary-btn" onclick="changeEmotion()">🌈 אותה שאלה על רגש אחר</button></div>
            <button class="main-btn" id="finish-turn-btn" onclick="finishTurn()" style="display: none; background: linear-gradient(135deg, var(--success-color), #2f855a);"> שיתפתי!</button>
        </div>

        <!-- שלב 5: מסך הניקוד -->
        <div id="scoring-screen" class="screen">
            <h2 id="scoring-title"></h2>
            <div class="scoring-container">
                <label id="honesty-label" for="honesty-score"></label>
                <div class="scoring-input-wrapper">
                    <input type="range" id="honesty-score" min="1" max="10" value="5" oninput="updateScoreDisplay('honesty-score', 'honesty-display')">
                    <span id="honesty-display" class="score-display">5</span>
                </div>
            </div>
            <div class="scoring-container">
                <label id="insight-label" for="insight-score"></label>
                 <div class="scoring-input-wrapper">
                    <input type="range" id="insight-score" min="1" max="10" value="5" oninput="updateScoreDisplay('insight-score', 'insight-display')">
                    <span id="insight-display" class="score-display">5</span>
                </div>
            </div>
            <button class="main-btn" onclick="submitScore()">העבר את התור</button>
        </div>

        <!-- שלב 6: מסך סיום -->
        <div id="end-screen" class="screen">
             <h1>💖 סיום המשחק 💖</h1>
            <div id="final-scores"></div>
            <div id="winner-announcement"></div>
            <div id="loser-prize-task" style="background-color: #fff9e6; padding: 15px; border-radius: 10px; margin-top:20px;"></div>
            <div id="winner-prize-task" style="background-color: #f0fff4; padding: 15px; border-radius: 10px; margin-top:15px;"></div>
            <p style="margin-top: 30px; font-size: 1.4em; font-style: italic; color: var(--secondary-color);">כל הכבוד! המתנה האמיתית היא הפתיחות וההקשבה.</p>
        </div>
    </div>

    <script>
        // --- מאגרי מידע ---
        // קבוצות רגשות (זהות לשני המינים)
        const emotionGroup1 = ["שמחה", "ביטחון", "גאווה", "תקווה", "אהבה", "שייכות", "רוגע", "סיפוק", "שלווה", "נחישות"];
        const emotionGroup2 = ["תסכול", "בושה", "קנאה", "אכזבה", "פחד", "עצב", "בדידות", "חרטה", "בלבול", "חוסר אונים", "כעס", "חרדה", "ייאוש", "אשמה"];
        const emotionGroup3 = ["התרגשות", "הקלה", "הכרת תודה", "השתאות", "תשוקה", "געגוע", "עצבנות", "התפעמות", "חמלה"];
        const allEmotions = [...emotionGroup1, ...emotionGroup2, ...emotionGroup3];

        // מאגרי שאלות לגבר
        const questionPoolA_male = ["מתי הרגשת לאחרונה ___?", "ספר על מקרה מהילדות שבו הרגשת ___.", "תאר סיטואציה שבה הופתעת מהעוצמה של ה___ שהרגשת.", "מה גרם לך להרגיש ___ בפעם האחרונה?", "מה אתה נוטה לעשות כשאתה מרגיש ___?", "איך אתה נראה כלפי חוץ כשאתה מרגיש ___?", "מה עובר לך בראש כשאתה מרגיש ___?", "אתה מרשה לעצמך להרגיש ___?", "האם אתה מרגיש בנוח לדבר על ___? עם מי כן או לא?", "האם יש אדם מסוים שמעורר אצלך ___?", "מה אתה רוצה שאחרים ידעו עליך כשאתה מרגיש ___?", "מה למדת על עצמך דרך חוויה של ___?"];
        const questionPoolB_male = [...questionPoolA_male, "איזו תקופה בחיים שלך הייתה מלאה ב___?", "באיזה אופן ___ הוא חלק מהאישיות שלך?", "עם מי בחיים שלך אתה מרגיש הכי ___?", "באיזו עבודה או פעילות אתה מרגיש הכי הרבה ___?", "איזה מקום מזכיר לך תחושה של ___?", "אילו דרכים עוזרות לך להתמודד עם ___?", "איך אתה מתנהג כשמישהו אחר סביבך מרגיש ___?", "האם אתה מרגיש אשמה כשאתה מרגיש ___?", "באיזה תחום בחיים שלך היית רוצה להתמודד אחרת עם ___?", "אילו דברים אתה עושה כדי לא להרגיש ___?", "מה היית רוצה שיגידו לך ברגע של ___?", "האם אתה מתבייש ב___?", "עם מי קשה לך להיות כשאתה מרגיש ___?"];
        const questionPoolC_male = [...questionPoolA_male, "איזו תקופה בחיים שלך הייתה מלאה ב___?", "באיזה אופן ___ הוא חלק מהאישיות שלך?", "עם מי בחיים שלך אתה מרגיש הכי ___?", "באיזו עבודה או פעילות אתה מרגיש הכי הרבה ___?", "איזה מקום מזכיר לך תחושה של ___?"];
        
        // מאגרי שאלות לאישה
        const questionPoolA_female = ["מתי הרגשת לאחרונה ___?", "ספרי על מקרה מהילדות שבו הרגשת ___.", "תארי סיטואציה שבה הופתעת מהעוצמה של ה___ שהרגשת.", "מה גרם לך להרגיש ___ בפעם האחרונה?", "מה את נוטה לעשות כשאת מרגישה ___?", "איך את נראית כלפי חוץ כשאת מרגישה ___?", "מה עובר לך בראש כשאת מרגישה ___?", "את מרשה לעצמך להרגיש ___?", "האם את מרגישה בנוח לדבר על ___? עם מי כן או לא?", "האם יש אדם מסוים שמעורר אצלך ___?", "מה את רוצה שאחרים ידעו עלייך כשאת מרגישה ___?", "מה למדת על עצמך דרך חוויה של ___?"];
        const questionPoolB_female = [...questionPoolA_female, "איזו תקופה בחיים שלך הייתה מלאה ב___?", "באיזה אופן ___ הוא חלק מהאישיות שלך?", "עם מי בחיים שלך את מרגישה הכי ___?", "באיזו עבודה או פעילות את מרגישה הכי הרבה ___?", "איזה מקום מזכיר לך תחושה של ___?", "אילו דרכים עוזרות לך להתמודד עם ___?", "איך את מתנהגת כשמישהו אחר סביבך מרגיש ___?", "האם את מרגישה אשמה כשאת מרגישה ___?", "באיזה תחום בחיים שלך היית רוצה להתמודד אחרת עם ___?", "אילו דברים את עושה כדי לא להרגיש ___?", "מה היית רוצה שיגידו לך ברגע של ___?", "האם את מתביישת ב___?", "עם מי קשה לך להיות כשאת מרגישה ___?"];
        const questionPoolC_female = [...questionPoolA_female, "איזו תקופה בחיים שלך הייתה מלאה ב___?", "באיזה אופן ___ הוא חלק מהאישיות שלך?", "עם מי בחיים שלך את מרגישה הכי ___?", "באיזו עבודה או פעילות את מרגישה הכי הרבה ___?", "איזה מקום מזכיר לך תחושה של ___?"];

        // --- משתני משחק גלובליים ---
        let husband = {}, wife = {}, currentPlayer = 'husband', currentRound = 1, maxRounds = 10;
        let currentQuestion, currentEmotion, currentCategory;

        // --- פונקציות ניהול ---
        function switchScreen(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
        function proceedToSetup() { switchScreen('setup-screen'); }
        function proceedToHusbandPrize() { husband.name = document.getElementById('husband-name').value.trim(); wife.name = document.getElementById('wife-name').value.trim(); if (!husband.name || !wife.name) { alert('יש למלא את שני השמות.'); return; } document.getElementById('husband-prize-title').innerText = `🎁 הפרס שלך, ${husband.name}`; switchScreen('husband-prize-screen'); }
        function proceedToWifePrize() { husband.prize = document.getElementById('husband-prize').value.trim(); if (!husband.prize) { alert('צריך לרשום מתנה :)'); return; } document.getElementById('wife-prize-title').innerText = `🎁 הפרס שלך, ${wife.name}`; switchScreen('wife-prize-screen'); }
        function startGame() { wife.prize = document.getElementById('wife-prize').value.trim(); if (!wife.prize) { alert('צריך לרשום מתנה :)'); return; } husband.score = 0; wife.score = 0; switchScreen('game-screen'); resetTurn(); }
        function resetTurn() { updateGenderedText(); document.getElementById('result').innerHTML = `<div class="placeholder-text">לחצו על הכפתור...</div>`; ['draw-btn','difficulty-container','change-buttons','finish-turn-btn'].forEach(id => { document.getElementById(id).style.display = id === 'draw-btn' ? 'inline-block' : 'none'; }); }
        
        function updateGenderedText() { 
            const p = (currentPlayer === 'husband') ? husband : wife; 
            document.getElementById('turn-indicator').innerText = `סבב ${Math.ceil(currentRound/2)}/5`; 
            document.getElementById('current-player-display').className = `current-player-display ${currentPlayer}`; 
            if(currentPlayer === 'husband'){ 
                document.getElementById('turn-prompt').innerText = `תורו של ${p.name} לשתף`; 
                document.getElementById('draw-btn').innerText = '🎲 בוא נדבר על...'; 
            } else { 
                document.getElementById('turn-prompt').innerText = `תורה של ${p.name} לשתף`; 
                document.getElementById('draw-btn').innerText = '🎲 בואי נדבר על...'; 
            }
        }
        
        // --- לוגיקת המשחק המעודכנת ---
        function drawPair() {
            const btn = document.getElementById('draw-btn');
            btn.disabled = true;
            document.getElementById('result').innerHTML = 'בוחרים לך שאלה מעוררת מחשבה ושיח...';
            
            setTimeout(() => {
                currentEmotion = allEmotions[Math.floor(Math.random() * allEmotions.length)];

                // זהה קטגוריית רגש
                if (emotionGroup1.includes(currentEmotion)) currentCategory = 'A';
                else if (emotionGroup2.includes(currentEmotion)) currentCategory = 'B';
                else currentCategory = 'C';

                // בחר מאגר שאלות לפי מין וקטגוריה
                const isMale = currentPlayer === 'husband';
                let questionPool;
                if (currentCategory === 'A') questionPool = isMale ? questionPoolA_male : questionPoolA_female;
                else if (currentCategory === 'B') questionPool = isMale ? questionPoolB_male : questionPoolB_female;
                else questionPool = isMale ? questionPoolC_male : questionPoolC_female;
                
                currentQuestion = questionPool[Math.floor(Math.random() * questionPool.length)];

                updateDisplay();
                btn.style.display = 'none';
                btn.disabled = false;
                document.getElementById('finish-turn-btn').style.display = 'inline-block';
                document.getElementById('difficulty-container').style.display = 'block';
            }, 1200);
        }

        function updateDisplay() {
            const formattedQuestion = currentQuestion.replace(/___/g, `<span class="emotion-highlight">${currentEmotion}</span>`);
            document.getElementById('result').innerHTML = `<div class="question-text">${formattedQuestion}</div>`;
            hideChangeOptions();
        }

        function showChangeOptions() { document.getElementById('difficulty-container').style.display = 'none'; document.getElementById('change-buttons').style.display = 'flex'; }
        function hideChangeOptions() { document.getElementById('difficulty-container').style.display = 'block'; document.getElementById('change-buttons').style.display = 'none'; }
        
        function changeQuestion() {
            const isMale = currentPlayer === 'husband';
            let questionPool;
            if (currentCategory === 'A') questionPool = isMale ? questionPoolA_male : questionPoolA_female;
            else if (currentCategory === 'B') questionPool = isMale ? questionPoolB_male : questionPoolB_female;
            else questionPool = isMale ? questionPoolC_male : questionPoolC_female;
            
            currentQuestion = questionPool[Math.floor(Math.random() * questionPool.length)];
            updateDisplay();
        }

        function changeEmotion() {
            let emotionPool;
            if (currentCategory === 'A') emotionPool = emotionGroup1;
            else if (currentCategory === 'B') emotionPool = emotionGroup2;
            else emotionPool = emotionGroup3;
            
            currentEmotion = emotionPool[Math.floor(Math.random() * emotionPool.length)];
            updateDisplay();
        }
        
        function finishTurn() {
            const answeringPlayer = (currentPlayer === 'husband') ? husband : wife;
            const scoringPlayer = (currentPlayer === 'husband') ? wife : husband;
            document.getElementById('scoring-title').innerText =  `${scoringPlayer.name}, תורך לתת ציון`;
            const isMaleAnswering = currentPlayer === 'husband';document.getElementById('honesty-label').innerText = `כמה הרגשת ש${answeringPlayer.name} ${isMaleAnswering ? 'היה כן (מלשון כנות)' : 'הייתה כנה'}? (1-10)`;
            document.getElementById('insight-label').innerText = `כמה התשובה עזרה לך להכיר אות${isMaleAnswering ? 'ו' : 'ה'} יותר טוב? (1-10)`;
            document.getElementById('honesty-score').value = 5;
            document.getElementById('insight-score').value = 5;
            updateScoreDisplay('honesty-score', 'honesty-display');
            updateScoreDisplay('insight-score', 'insight-display');
            switchScreen('scoring-screen');
        }

        function updateScoreDisplay(sliderId, displayId) { document.getElementById(displayId).innerText = document.getElementById(sliderId).value; }

        function submitScore() { 
            const score = parseInt(document.getElementById('honesty-score').value) + parseInt(document.getElementById('insight-score').value); 
            if (currentPlayer === 'husband') husband.score += score; 
            else wife.score += score; 
            currentRound++; 
            if (currentRound > maxRounds) endGame(); 
            else { currentPlayer = (currentPlayer === 'husband') ? 'wife' : 'husband'; resetTurn(); switchScreen('game-screen'); } 
        }

        function endGame() {
            const finalScoresEl = document.getElementById('final-scores');
            const winnerAnnouncementEl = document.getElementById('winner-announcement');
            const loserPrizeEl = document.getElementById('loser-prize-task');
            const winnerPrizeEl = document.getElementById('winner-prize-task');

            finalScoresEl.innerHTML = `<h2><strong>${husband.name}:</strong> ${husband.score} נק' | <strong>${wife.name}:</strong> ${wife.score} נק'</h2>`;
            loserPrizeEl.innerHTML = '';
            winnerPrizeEl.innerHTML = '';

            let winner, loser;
            if (husband.score > wife.score) {
                winner = husband;
                loser = wife;
                winnerAnnouncementEl.innerHTML = `<h3>כל הכבוד, <span style="color:var(--success-color);font-weight:bold;">${winner.name}</span>, ניצחת!</h3>`;
                loserPrizeEl.innerHTML = `<p>${loser.name}, הגיע הזמן להעניק ל${winner.name} את הפרס: <strong>${winner.prize}</strong></p>`;
                winnerPrizeEl.innerHTML = `<p>ו... ${winner.name}, עכשיו תורך להפתיע! <br> הענק ל${loser.name} את הפרס שביקשה, <strong>${loser.prize}</strong>, סתם כי אתם אוהבים ❤️.</p>`;
            } else if (wife.score > husband.score) {
                winner = wife;
                loser = husband;
                winnerAnnouncementEl.innerHTML = `<h3>כל הכבוד, <span style="color:var(--success-color);font-weight:bold;">${winner.name}</span>, ניצחת!</h3>`;
                loserPrizeEl.innerHTML = `<p>${loser.name}, הגיע הזמן להעניק ל${winner.name} את הפרס: <strong>${winner.prize}</strong></p>`;
                winnerPrizeEl.innerHTML = `<p>ו... ${winner.name}, עכשיו תורך להפתיע! <br> העניקי ל${loser.name} את הפרס שביקש, <strong>${loser.prize}</strong>, סתם כי אתם אוהבים ❤️.</p>`;
            } else {
                winnerAnnouncementEl.innerHTML = `<h3>תיקו! במשחק הזה, שניכם ניצחתם! 🥳</h3>`;
                loserPrizeEl.innerHTML = `<p>כל אחד מעניק לשני את הפרס שבחר. <br>${husband.name}, הענק ל${wife.name} את הפרס: <strong>${wife.prize}</strong></p>`;
                winnerPrizeEl.innerHTML = `<p>${wife.name}, העניקי ל${husband.name} את הפרס: <strong>${husband.prize}</strong></p>`;
            }
            switchScreen('end-screen');
        }

        // --- לוגיקת מסך טעינה ---
        document.addEventListener('DOMContentLoaded', function() {
            const mainContainer = document.getElementById('main-container');
            mainContainer.style.opacity = '0';
            let loadingProgress = 0;
            const progressBar = document.getElementById('loading-bar');
            const progressText = document.getElementById('loading-percentage');
            function updateLoadingProgress() {
                loadingProgress += Math.random() * 10 + 5;
                if (loadingProgress > 100) loadingProgress = 100;
                progressBar.style.width = loadingProgress + '%';
                progressText.textContent = Math.floor(loadingProgress) + '%';
                if (loadingProgress < 100) { setTimeout(updateLoadingProgress, 150 + Math.random() * 200); }
                else { setTimeout(hideLoadingScreen, 800); }
            }
            function hideLoadingScreen() {
                const loadingScreen = document.getElementById('loading-screen');
                loadingScreen.classList.add('fade-out');
                setTimeout(() => { 
                    loadingScreen.style.display = 'none'; 
                    mainContainer.style.opacity = '1';
                    mainContainer.style.animation = 'containerFadeIn 0.8s ease-out forwards';
                    switchScreen('instructions-screen'); 
                }, 1000);
            }
            setTimeout(updateLoadingProgress, 500);
        });
    </script>
</body>
</html>